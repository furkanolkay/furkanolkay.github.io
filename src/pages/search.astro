---
import BaseLayout from '../layouts/BaseLayout.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import { getCollection } from 'astro:content';

const blogPosts = (await getCollection('blog'))
  .filter(post => !post.data.draft);

const projects = (await getCollection('projects'))
  .filter(project => !project.data.draft);

const allContent = [
  ...blogPosts.map(post => ({ type: 'blog', title: post.data.title, id: post.id, tags: post.data.tags || [], description: post.data.description || '' })),
  ...projects.map(project => ({ type: 'project', title: project.data.title, id: project.id, tags: project.data.tags || [], description: project.data.description || '' }))
];
---

<BaseLayout 
  title="Search - Find Blog Posts & Projects"
  description="Search through all blog posts and projects. Find Flutter tutorials, mobile development articles, and software engineering content quickly."
  keywords={["search", "find articles", "flutter search", "blog search", "project search"]}
>
  <Navigation />
  
  <section class="pt-32 pb-24 min-h-screen bg-gradient-to-br from-slate-950 via-purple-950 to-slate-900">
    <div class="container mx-auto">
      <!-- Header -->
      <div class="text-center mb-16">
        <div class="inline-flex items-center gap-2 px-4 py-2 bg-purple-500/20 backdrop-blur-sm border border-purple-500/30 rounded-full mb-6">
          <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
          <span class="text-purple-300">Arama</span>
        </div>
        
        <h1 class="text-5xl font-bold text-white mb-4">
          Arama
        </h1>
        <p class="text-gray-400 max-w-2xl mx-auto text-lg">
          Tüm blog yazıları ve projeler arasında arama yapın.
        </p>
      </div>

      <!-- Search Input -->
      <div class="max-w-2xl mx-auto mb-12">
        <div class="relative">
          <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
            <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
          </div>
          <input 
            type="text" 
            id="searchInput" 
            placeholder="Aramak istediğiniz kelimeyi yazın..." 
            class="w-full pl-12 pr-4 py-4 bg-white/5 backdrop-blur-xl border-2 border-white/10 rounded-2xl text-white placeholder:text-gray-500 focus:border-purple-500/50 focus:ring-4 focus:ring-purple-500/20 focus:shadow-[0_0_20px_rgba(168,85,247,0.2)] outline-none transition-all"
          />
        </div>
        <p class="text-gray-400 text-sm mt-4 text-center" id="resultCount">
          {allContent.length} içerik bulundu
        </p>
      </div>

      <!-- Search Results -->
      <div id="searchResults" class="max-w-4xl mx-auto space-y-4">
        {allContent.map((item) => (
          <a href={`/${item.type}/${item.id}`} class="group search-item block">
            <div class="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl p-6 hover:bg-white/10 transition-all">
              <div class="flex items-start justify-between gap-4 mb-3">
                <h3 class="text-white mb-2 group-hover:text-purple-400 transition-colors text-xl font-bold flex-grow">
                  {item.title}
                </h3>
                <span class="inline-flex items-center gap-2 px-3 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 border border-purple-500/30 rounded-full text-sm text-purple-300 capitalize flex-shrink-0">
                  {item.type === 'blog' ? (
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                    </svg>
                  ) : (
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
                    </svg>
                  )}
                  {item.type === 'blog' ? 'Blog Yazısı' : 'Proje'}
                </span>
              </div>
              
              {item.description && (
                <p class="text-gray-400 mb-4 line-clamp-2">{item.description}</p>
              )}
              
              {item.tags.length > 0 && (
                <div class="flex flex-wrap gap-2">
                  {item.tags.map((tag) => (
                    <span class="px-3 py-1.5 bg-purple-500/20 border border-purple-500/30 rounded-full text-sm text-purple-300">
                      {tag}
                    </span>
                  ))}
                </div>
              )}
            </div>
          </a>
        ))}
      </div>

      <div id="noResults" class="hidden text-center py-16">
        <svg class="w-24 h-24 mx-auto text-gray-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <p class="text-gray-400 text-lg">Aradığınız kriterlere uygun içerik bulunamadı.</p>
      </div>
    </div>
  </section>

  <Footer />
</BaseLayout>

<script>
  const searchInput = document.getElementById('searchInput');
  const searchResults = document.getElementById('searchResults');
  const noResults = document.getElementById('noResults');
  const resultCount = document.getElementById('resultCount');
  const items = Array.from(document.querySelectorAll('.search-item'));
  const allItems = items;

  searchInput.addEventListener('input', (e) => {
    const query = e.target.value.toLowerCase().trim();
    
    if (!query) {
      items.forEach(item => item.style.display = '');
      noResults.classList.add('hidden');
      resultCount.textContent = `${allItems.length} içerik bulundu`;
      return;
    }

    let visibleCount = 0;
    items.forEach(item => {
      const text = item.textContent.toLowerCase();
      if (text.includes(query)) {
        item.style.display = '';
        visibleCount++;
      } else {
        item.style.display = 'none';
      }
    });

    if (visibleCount === 0) {
      searchResults.classList.add('hidden');
      noResults.classList.remove('hidden');
    } else {
      searchResults.classList.remove('hidden');
      noResults.classList.add('hidden');
    }

    resultCount.textContent = `${visibleCount} sonuç bulundu`;
  });
</script>

<style>
  .search-item {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
  }

  .search-item.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  // Initial fade in animation
  const searchObserver = new IntersectionObserver((entries) => {
    entries.forEach((entry, index) => {
      if (entry.isIntersecting) {
        setTimeout(() => {
          entry.target.classList.add('visible');
        }, index * 50);
      }
    });
  }, { threshold: 0.1 });

  document.querySelectorAll('.search-item').forEach(item => {
    searchObserver.observe(item);
  });
</script>
